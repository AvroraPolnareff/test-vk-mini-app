(this["webpackJsonptest-vk-mini-app"]=this["webpackJsonptest-vk-mini-app"]||[]).push([[0],{136:function(e,t,n){e.exports=n.p+"static/media/persik.4e1ec840.png"},203:function(e,t,n){e.exports=n(308)},301:function(e,t,n){},308:function(e,t,n){"use strict";n.r(t);n(204),n(230),n(232),n(233),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272);var a=n(0),r=n.n(a),c=n(60),i=n.n(c),s=n(21),o=n.n(s),u=n(26),l=n.n(u),m=n(45),d=n(38),f=n(85),p=n.n(f),b=n(141),h=n.n(b),E=(n(281),n(61)),v=n.n(E),g=n(62),j=n.n(g),O=n(95),x=n.n(O),k=n(94),w=n.n(k),y=n(130),_=n.n(y),C=n(132),F=n.n(C),S=n(131),I=n.n(S),U=function(e){var t=e.id,n=e.go,a=e.fetchedUser;return r.a.createElement(v.a,{id:t},r.a.createElement(j.a,null,"Example"),a&&r.a.createElement(w.a,{title:"User Data Fetched with VK Bridge"},r.a.createElement(_.a,{before:a.photo_200?r.a.createElement(I.a,{src:a.photo_200}):null,description:a.city&&a.city.title?a.city.title:""},"".concat(a.first_name," ").concat(a.last_name))),r.a.createElement(w.a,{title:"Navigation Example"},r.a.createElement(F.a,null,r.a.createElement(x.a,{size:"xl",level:"2",onClick:n,"data-to":"persik"},"Show me the Persik, please"),r.a.createElement(x.a,{style:{marginTop:"1em"},size:"xl",level:"2",onClick:n,"data-to":"friends"},"To Friends List"))))},P=n(8),A=n(137),M=n.n(A),T=n(64),q=n.n(T),K=n(65),R=n.n(K),V=n(136),z=n.n(V),D=(n(301),Object(P.u)()),L=function(e){return r.a.createElement(v.a,{id:e.id},r.a.createElement(j.a,{left:r.a.createElement(M.a,{onClick:e.go,"data-to":"home"},D===P.i?r.a.createElement(q.a,null):r.a.createElement(R.a,null))},"Persik"),r.a.createElement("img",{className:"Persik",src:z.a,alt:"Persik The Cat"}))},W=n(48),N=n(68),B=n(142),Y=n(67),G=n.n(Y),J=function(e){var t=e.split(".");if(3===t.length){var n=new Date;n.setFullYear(t[2],t[1],t[0]);var a=new Date(Date.now());return"".concat(a.getFullYear()-n.getFullYear())}return""},H=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function Q(){var e=new URLSearchParams(window.location.search);return parseInt(e.get("vk_app_id"),10)}function X(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(m.a)(l.a.mark((function e(t,n){var a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=parseInt(t,10),a={app_id:t,scope:n.toString()},e.next=4,o.a.send("VKWebAppGetAuthToken",a);case 4:if((r=e.sent).scope===n){e.next=9;break}throw new Error("Earned token scope mismatch");case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t,n){return ee.apply(this,arguments)}function ee(){return(ee=Object(B.a)(l.a.mark((function e(t,n,a){var r,c,i,s,o,u,m,d,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(N.a)(X(Q(),"friends"));case 2:r=e.sent,c=["nickname","photo_100","sex","bdate","domain"],i=[t],s=0,o=[],u=[],m=!1;case 9:if(!(o.length<n||s>=o.length)){e.next=30;break}return e.next=12,Object(N.a)(re(i,c,r));case 12:if(!(d=e.sent).response.length){e.next=24;break}if(f=ae(d.response),o=G.a.unionBy(o,f,"id"),!a||!te(a)){e.next=21;break}return m=!0,u=ne(o,a),e.next=21,u;case 21:if(m){e.next=24;break}return e.next=24,o;case 24:return e.next=26,Object(N.a)(H(300));case 26:s+=i.length,i=o.slice(s,s+10).map((function(e){return e.id})),e.next=9;break;case 30:if(!m){e.next=34;break}return e.abrupt("return",u);case 34:return e.abrupt("return",o);case 35:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return Object.values(e).some((function(e){return e}))}function ne(e,t){var n=e;return t&&(t.q&&(n=n.filter((function(e){return-1!==(e.first_name+" "+e.last_name).toLowerCase().indexOf(t.q.toLowerCase())}))),t.age&&(n=n.filter((function(e){var n=e.bdate;return n&&parseInt(J(n),10)===t.age}))),t.sex&&(n=n.filter((function(e){return e.sex===parseInt(t.sex,10)})))),n}function ae(e){return e.filter((function(e){return!e.hasOwnProperty("deactivated")&&!0===e.can_access_closed}))}function re(e,t,n){return ce.apply(this,arguments)}function ce(){return(ce=Object(m.a)(l.a.mark((function e(t,n,a){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="\n    var users = [".concat(t.toString(),'];\n    var allFoundUsers = [];\n    var i = 0;\n    while (i < users.length) {\n      var foundUsers = API.friends.search({\n        "fields": "').concat(n.toString(),'",\n        "user_id": users[i]\n      });\n      \n      if (foundUsers.items.length) {\n        var j = 0;\n        while (j < foundUsers.items.length) {\n          allFoundUsers.push(foundUsers.items[j]);\n          j = j + 1;\n        }\n      }\n      i = i + 1;\n    }\n    \n    return allFoundUsers;\n  '),e.next=3,o.a.send("VKWebAppCallAPIMethod",{method:"execute",params:{access_token:a.access_token,v:"5.124",code:r}});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=n(138),se=n.n(ie),oe=n(140),ue=n.n(oe),le=n(53),me=n.n(le),de=n(37),fe=n(47),pe="FRIENDS_FILTERS",be=Object(fe.b)({name:"modals",initialState:null,reducers:{showModal:function(e,t){return t.payload},closeModal:function(e){return null}}}),he=be.actions,Ee=he.showModal,ve=he.closeModal,ge=be.reducer,je={sex:0,age:""},Oe=Object(fe.b)({name:"friendsFilters",initialState:je,reducers:{resetFilters:function(e){je},changeFilters:function(e,t){return Object(W.a)(Object(W.a)({},e),t.payload)}}}),xe=Oe.actions,ke=xe.changeFilters,we=xe.resetFilters,ye=Oe.reducer,_e=Object(P.u)(),Ce=function(e){var t=e.id,n=e.user,c=e.go,i=Object(a.useState)(""),s=Object(d.a)(i,2),o=s[0],u=s[1],l=Object(a.useState)(!1),m=Object(d.a)(l,2),f=(m[0],m[1]),p=Object(a.useState)([]),b=Object(d.a)(p,2),h=b[0],E=b[1],v=Object(a.useState)(!0),g=Object(d.a)(v,2),j=g[0],O=g[1],x=Object(de.b)(),k=Object(de.c)((function(e){return e.friendsFilters})),w=Object(a.useRef)($(n.id,2e3,Object(W.a)({q:o},k))),y=Object(a.useRef)(G.a.debounce((function(){f(!0),w.current.next().then((function(e){f(!1),O(!e.done),e.done||E(e.value)}))}),500));Object(a.useEffect)((function(){w.current=$(n.id,2e3,Object(W.a)({q:o},k)),y.current()}),[o,n,k]);var _=function(e){return e.bdate?J(e.bdate):""},C=function(e){return 1===e.sex?"\u0416\u0435\u043d\u0449\u0438\u043d\u0430":2===e.sex?"\u041c\u0443\u0436\u0447\u0438\u043d\u0430":""},F=function(e){var t=_(e);return"".concat(C(e)).concat(t?", ".concat(t):"")},S=Object(a.useMemo)((function(){var e=h.map((function(e){return{id:e.id,first_name:e.first_name,last_name:e.last_name,age:_(e),sex:C(e),photo_100:e.photo_100,description:F(e)}}));return e}),[h,o]);return r.a.createElement(P.o,{id:t},r.a.createElement(P.p,{left:r.a.createElement(P.q,{onClick:c,"data-to":"home"},_e===P.i?r.a.createElement(q.a,null):r.a.createElement(R.a,null))},"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438"),r.a.createElement(P.e,{vertical:"top"},r.a.createElement(P.s,{value:o,onChange:function(e){u(e.target.value)},icon:r.a.createElement(ue.a,null),onIconClick:function(){x(Ee(pe))}})),r.a.createElement(P.h,{style:{paddingTop:"60px"}},r.a.createElement(P.k,null,r.a.createElement(se.a,{loadMore:y.current,hasMore:j,loader:r.a.createElement(P.c,null,r.a.createElement(P.t,null))},S&&S.map((function(e){return r.a.createElement(P.c,{key:e.id,before:r.a.createElement(P.a,{src:e.photo_100}),description:e.description},"".concat(e.first_name," ").concat(e.last_name))}))))))},Fe=function(e){var t=e.id,n=Object(de.b)(),a=Object(de.c)((function(e){return e.friendsFilters})),c=function(){n(ve())};return r.a.createElement(P.l,{id:t,onClose:c,header:r.a.createElement(P.m,{right:r.a.createElement(P.q,{onClick:c},r.a.createElement(me.a,null))},"\u0424\u0438\u043b\u044c\u0442\u0440\u044b")},r.a.createElement(P.f,null,r.a.createElement(P.g,{top:"\u041f\u043e\u043b",value:a.sex,onChange:function(e){n(ke({sex:parseInt(e.target.value,10)}))}},r.a.createElement(P.r,{name:"sex",value:0,defaultChecked:!0},"\u041b\u044e\u0431\u043e\u0439"),r.a.createElement(P.r,{name:"sex",value:2},"\u041c\u0443\u0436\u0441\u043a\u043e\u0439"),r.a.createElement(P.r,{name:"sex",value:1},"\u0416\u0435\u043d\u0441\u043a\u0438\u0439")),r.a.createElement(P.g,{top:"\u0412\u043e\u0437\u0440\u0430\u0441\u0442"},r.a.createElement(P.j,{type:"number",name:"age",value:a.age,onChange:function(e){n(ke({age:parseInt(e.target.value)}))}})),r.a.createElement(P.d,{style:{display:"flex"}},r.a.createElement(P.b,{size:"l",stretched:!0,mode:"secondary",onClick:function(){n(we())},style:{marginRight:8}},"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c"),r.a.createElement(P.b,{size:"l",stretched:!0,onClick:c},"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c"))))},Se=function(){var e=Object(a.useState)("home"),t=Object(d.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(null),s=Object(d.a)(i,2),u=s[0],f=s[1],b=Object(a.useState)(r.a.createElement(h.a,{size:"large"})),E=Object(d.a)(b,2),v=E[0],g=E[1],j=Object(de.c)((function(e){return e.modals}));Object(a.useEffect)((function(){function e(){return(e=Object(m.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.send("VKWebAppGetUserInfo");case 2:t=e.sent,f(t),g(null);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o.a.subscribe((function(e){var t=e.detail,n=t.type,a=t.data;if("VKWebAppUpdateConfig"===n){var r=document.createAttribute("scheme");r.value=a.scheme?a.scheme:"client_light",document.body.attributes.setNamedItem(r)}})),function(){e.apply(this,arguments)}()}),[]);var O=function(e){c(e.currentTarget.dataset.to)},x=r.a.createElement(P.n,{activeModal:j},r.a.createElement(Fe,{id:pe}));return r.a.createElement(p.a,{activePanel:n,popout:v,modal:x},r.a.createElement(U,{id:"home",fetchedUser:u,go:O}),r.a.createElement(L,{id:"persik",go:O}),r.a.createElement(Ce,{id:"friends",user:u,go:O}))},Ie=n(28),Ue=Object(Ie.c)({friendsFilters:ye,modals:ge});o.a.send("VKWebAppInit");var Pe=Object(fe.a)({reducer:Ue});i.a.render(r.a.createElement(de.a,{store:Pe},r.a.createElement(Se,null)),document.getElementById("root"))}},[[203,1,2]]]);
//# sourceMappingURL=main.c1cdc274.chunk.js.map