{"version":3,"sources":["img/persik.png","panels/Home.js","panels/Persik.js","utils/helpers.js","api/vk.js","store/modalsSlice.js","store/friendsFiltersSlice.js","panels/Friends.js","App.js","store/index.js","index.js"],"names":["module","exports","Home","id","go","fetchedUser","title","before","photo_200","src","description","city","first_name","last_name","size","level","onClick","data-to","style","marginTop","osName","platform","Persik","props","left","IOS","className","persik","alt","parseVkDate","date","dateArray","split","length","Date","setFullYear","now","getFullYear","sleep","time","Promise","resolve","setTimeout","getAppId","params","URLSearchParams","window","location","search","parseInt","get","fetchToken","appId","scope","a","sendObj","toString","bridge","send","token","Error","getFriendsIterable","userId","totalCount","searchOptions","fields","ids","offset","users","searchResults","searchMode","getFriendsForUsers","foundFriends","response","filtered","filterNotActiveUsers","_","unionBy","isOptionsSetted","filterUsers","slice","map","user","Object","values","some","value","q","filter","toLowerCase","indexOf","age","bdate","sex","hasOwnProperty","can_access_closed","userIds","code","access_token","Modals","modalsSlice","createSlice","name","initialState","reducers","showModal","state","action","payload","closeModal","actions","modalsReducer","reducer","initState","friendsFiltersSlice","resetFilters","changeFilters","friendsFiltersReducer","Friends","useState","setValue","setLoading","closePeoples","setClosePeoples","hasMore","setHasMore","dispatch","useDispatch","filtersState","useSelector","friendsFilters","iterableFetch","useRef","debounceFetch","debounce","current","next","then","newFriends","done","useEffect","getAge","friend","getSex","getDescription","displayedFriends","useMemo","processedFriends","photo_100","vertical","onChange","e","target","icon","onIconClick","paddingTop","loadMore","loader","key","FiltersModal","onModalClose","onClose","header","right","top","defaultChecked","type","display","stretched","mode","marginRight","App","activePanel","setActivePanel","setUser","popout","setPopout","activeModal","modals","subscribe","detail","data","schemeAttribute","document","createAttribute","scheme","body","attributes","setNamedItem","fetchData","currentTarget","dataset","to","modal","rootReducer","combineReducers","store","configureStore","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.c1cdc274.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/persik.4e1ec840.png\";","import React from 'react';\nimport PropTypes from 'prop-types';\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\nimport Button from '@vkontakte/vkui/dist/components/Button/Button';\nimport Group from '@vkontakte/vkui/dist/components/Group/Group';\nimport Cell from '@vkontakte/vkui/dist/components/Cell/Cell';\nimport Div from '@vkontakte/vkui/dist/components/Div/Div';\nimport Avatar from '@vkontakte/vkui/dist/components/Avatar/Avatar';\n\nconst Home = ({ id, go, fetchedUser }) => (\n\t<Panel id={id}>\n\t\t<PanelHeader>Example</PanelHeader>\n\t\t{fetchedUser &&\n\t\t<Group title=\"User Data Fetched with VK Bridge\">\n\t\t\t<Cell\n\t\t\t\tbefore={fetchedUser.photo_200 ? <Avatar src={fetchedUser.photo_200}/> : null}\n\t\t\t\tdescription={fetchedUser.city && fetchedUser.city.title ? fetchedUser.city.title : ''}\n\t\t\t>\n\t\t\t\t{`${fetchedUser.first_name} ${fetchedUser.last_name}`}\n\t\t\t</Cell>\n\t\t</Group>}\n\n\t\t<Group title=\"Navigation Example\">\n\t\t\t<Div>\n\t\t\t\t<Button size=\"xl\" level=\"2\" onClick={go} data-to=\"persik\">\n\t\t\t\t\tShow me the Persik, please\n\t\t\t\t</Button>\n\t\t\t\t<Button  style={{marginTop: \"1em\"}} size=\"xl\" level=\"2\" onClick={go} data-to=\"friends\">\n\t\t\t\t\tTo Friends List\n\t\t\t\t</Button>\n\t\t\t</Div>\n\t\t</Group>\n\t</Panel>\n);\n\nHome.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n\tfetchedUser: PropTypes.shape({\n\t\tphoto_200: PropTypes.string,\n\t\tfirst_name: PropTypes.string,\n\t\tlast_name: PropTypes.string,\n\t\tcity: PropTypes.shape({\n\t\t\ttitle: PropTypes.string,\n\t\t}),\n\t}),\n};\n\nexport default Home;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { platform, IOS } from '@vkontakte/vkui';\nimport Panel from '@vkontakte/vkui/dist/components/Panel/Panel';\nimport PanelHeader from '@vkontakte/vkui/dist/components/PanelHeader/PanelHeader';\nimport PanelHeaderButton from '@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton';\nimport Icon28ChevronBack from '@vkontakte/icons/dist/28/chevron_back';\nimport Icon24Back from '@vkontakte/icons/dist/24/back';\n\nimport persik from '../img/persik.png';\nimport './Persik.css';\n\nconst osName = platform();\n\nconst Persik = props => (\n\t<Panel id={props.id}>\n\t\t<PanelHeader\n\t\t\tleft={<PanelHeaderButton onClick={props.go} data-to=\"home\">\n\t\t\t\t{osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\n\t\t\t</PanelHeaderButton>}\n\t\t>\n\t\t\tPersik\n\t\t</PanelHeader>\n\t\t<img className=\"Persik\" src={persik} alt=\"Persik The Cat\"/>\n\t</Panel>\n);\n\nPersik.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tgo: PropTypes.func.isRequired,\n};\n\nexport default Persik;\n","export const parseVkDate = (date) => {\n  const dateArray = date.split(\".\");\n  if (dateArray.length === 3) {\n    const date = new Date()\n    date.setFullYear(dateArray[2], dateArray[1], dateArray[0])\n    const now = new Date(Date.now())\n    return `${now.getFullYear() - date.getFullYear()}`\n  } else {\n    return \"\"\n  }\n}\n\nexport const sleep = (time) => new Promise((resolve) => setTimeout(resolve, time))\n","import bridge from \"@vkontakte/vk-bridge\";\nimport _ from \"lodash\";\nimport {parseVkDate, sleep} from \"../utils/helpers\";\n\nconst VERSION = \"5.124\"\n\nexport async function searchFriends(token, userId, fields, q) {\n  const friends = await bridge.send('VKWebAppCallAPIMethod', {\n    \"method\": \"friends.search\",\n    \"params\": {\n      \"access_token\": token.access_token,\n      \"user_id\": userId,\n      \"q\": q,\n      \"count\": 1000,\n      \"v\": VERSION,\n      \"fields\": fields.toString(),\n      \"lang\": \"ru\"\n    }\n  })\n  return friends.response.items.filter((friend) => !friend.hasOwnProperty(\"deactivated\"))\n}\n\nexport async function fetchFriends(token, userId, fields) {\n  const friends = await bridge.send('VKWebAppCallAPIMethod', {\n    \"method\": \"friends.get\",\n    \"params\": {\n      \"access_token\": token.access_token,\n      \"user_id\": userId,\n      \"v\": VERSION,\n      \"fields\": fields.toString(),\n      \"lang\": \"ru\"\n    }\n  })\n  return friends.response.items.filter((friend) => !friend.hasOwnProperty(\"deactivated\"))\n}\n\nexport function getAppId() {\n  let params = new URLSearchParams(window.location.search)\n  return parseInt(params.get(\"vk_app_id\"), 10)\n}\n\nexport async function fetchToken(appId, scope) {\n  appId = parseInt(appId, 10)\n  const sendObj = {\n    \"app_id\": appId,\n    scope: scope.toString(),\n  }\n  const token = await bridge.send('VKWebAppGetAuthToken', sendObj);\n\n  if (token.scope !== scope) throw new Error(\"Earned token scope mismatch\")\n  else return token\n}\n\n\n/**\n * Generator that fetches and searches friends and friends of friends from vk api\n * @param {number} userId - app user\n * @param {number} totalCount - total amount of friends\n * @param {Object.<{q: string, sex: number, age: number}>} searchOptions\n */\nexport async function* getFriendsIterable(userId, totalCount, searchOptions) {\n  const token = await fetchToken(getAppId(), \"friends\")\n  const fields = [\"nickname\", \"photo_100\", \"sex\", \"bdate\", \"domain\"]\n  let ids = [userId]\n  let offset = 0\n  let users = []\n  let searchResults = []\n  let searchMode = false\n\n  while (users.length < totalCount || offset >= users.length) {\n    const foundFriends = await getFriendsForUsers(ids, fields, token)\n    if (foundFriends.response.length) {\n      let filtered = filterNotActiveUsers(foundFriends.response)\n      users = _.unionBy(users, filtered, 'id')\n\n      if (searchOptions && isOptionsSetted(searchOptions)) {\n        searchMode = true\n        searchResults = filterUsers(users, searchOptions)\n        yield searchResults\n      }\n\n      if (!searchMode) {\n        yield users\n      }\n    }\n    await sleep(300)\n    offset += ids.length\n    ids = users.slice(offset, offset + 10).map(user => user.id)\n  }\n  if (searchMode) {\n    return searchResults\n  } else {\n    return users\n  }\n}\n\nfunction isOptionsSetted (searchOptions) {\n  return Object.values(searchOptions).some(value => value)\n}\n\nfunction filterUsers(users, searchOptions) {\n  let filtered = users\n  if (searchOptions) {\n    if (searchOptions.q) {\n      filtered = filtered.filter(({first_name, last_name}) => (\n        (first_name + \" \" + last_name).toLowerCase().indexOf(searchOptions.q.toLowerCase()) !== -1\n      ))\n    }\n    if (searchOptions.age) {\n      filtered = filtered.filter((({bdate}) =>\n          bdate && parseInt(parseVkDate(bdate), 10) === searchOptions.age\n      ))\n    }\n    if (searchOptions.sex) {\n      filtered = filtered.filter((({sex}) =>\n          sex === parseInt(searchOptions.sex, 10)\n      ))\n    }\n  }\n  return filtered\n}\n\nfunction filterNotActiveUsers(users) {\n  return  users.filter((user) => (\n    !user.hasOwnProperty(\"deactivated\") && user.can_access_closed === true\n  ))\n}\n\nasync function getFriendsForUsers(userIds, fields, token) {\n  const code = `\n    var users = [${userIds.toString()}];\n    var allFoundUsers = [];\n    var i = 0;\n    while (i < users.length) {\n      var foundUsers = API.friends.search({\n        \"fields\": \"${fields.toString()}\",\n        \"user_id\": users[i]\n      });\n      \n      if (foundUsers.items.length) {\n        var j = 0;\n        while (j < foundUsers.items.length) {\n          allFoundUsers.push(foundUsers.items[j]);\n          j = j + 1;\n        }\n      }\n      i = i + 1;\n    }\n    \n    return allFoundUsers;\n  `\n  return await bridge.send('VKWebAppCallAPIMethod', {\n    \"method\": \"execute\",\n    \"params\": {\n      \"access_token\": token.access_token,\n      \"v\": VERSION,\n      \"code\": code\n    }\n  })\n}\n","import {createSlice} from \"@reduxjs/toolkit\";\n\nexport const Modals = {\n  FRIENDS_FILTERS: 'FRIENDS_FILTERS'\n}\n\nconst modalsSlice = createSlice({\n  name: 'modals',\n  initialState: null,\n  reducers: {\n    showModal(state, action) {\n      return action.payload\n    },\n    closeModal(state) {\n      return null\n    }\n  }\n})\n\nexport const {showModal, closeModal} = modalsSlice.actions\n\nexport const modalsReducer = modalsSlice.reducer\n","import {createSlice} from \"@reduxjs/toolkit\";\n\nexport const initState = {\n  sex: 0,\n  age: \"\",\n}\n\nconst friendsFiltersSlice = createSlice({\n  name: 'friendsFilters',\n  initialState: initState,\n  reducers: {\n    resetFilters: state => {\n      state = initState;\n    },\n    changeFilters: (state, action) => {\n      return {...state, ...action.payload}\n    }\n  }\n})\n\nexport const {changeFilters, resetFilters} = friendsFiltersSlice.actions\n\nexport const friendsFiltersReducer = friendsFiltersSlice.reducer\n","import React, {useEffect, useMemo, useRef, useState} from 'react'\nimport {\n  Radio,\n  Avatar,\n  Cell,\n  Group,\n  List,\n  Panel,\n  PanelHeaderBack,\n  PanelHeader,\n  Search,\n  Spinner,\n  FixedLayout,\n  ModalRoot,\n  ModalPage,\n  ModalPageHeader,\n  FormLayout,\n  FormLayoutGroup,\n  Input, Button,\n  Div, PanelHeaderButton, platform, IOS\n} from \"@vkontakte/vkui\";\nimport {getFriendsIterable} from \"../api/vk\";\nimport InfiniteScroll from \"react-infinite-scroller\";\nimport Icon24Filter from '@vkontakte/icons/dist/24/filter';\nimport Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {closeModal, Modals, showModal} from \"../store/modalsSlice\";\nimport {parseVkDate} from \"../utils/helpers\";\nimport {changeFilters, resetFilters} from \"../store/friendsFiltersSlice\";\nimport _ from 'lodash'\nimport Icon28ChevronBack from \"@vkontakte/icons/dist/28/chevron_back\";\nimport Icon24Back from \"@vkontakte/icons/dist/24/back\";\n\nconst osName = platform();\n\nexport const Friends = ({id, user, go}) => {\n  const [value, setValue] = useState(\"\")\n  const [loading, setLoading] = useState(false)\n  const [closePeoples, setClosePeoples] = useState([])\n  const [hasMore, setHasMore] = useState(true)\n  const dispatch = useDispatch()\n  const filtersState = useSelector(state => state.friendsFilters)\n\n\n  const iterableFetch = useRef(getFriendsIterable(user.id, 2000, {q: value,...filtersState}))\n\n  const fetchMoreData = () => {\n    setLoading(true)\n    iterableFetch.current.next()\n      .then(newFriends => {\n        setLoading(false)\n        setHasMore(!newFriends.done)\n        if (!newFriends.done) {\n          setClosePeoples(newFriends.value)\n        }\n      })\n  }\n\n  const debounceFetch = useRef(_.debounce(fetchMoreData, 500))\n\n  useEffect(() => {\n    iterableFetch.current = getFriendsIterable(user.id, 2000, {q: value,...filtersState})\n    debounceFetch.current()\n  }, [value, user, filtersState])\n\n  const getAge = (friend) => {\n    if (!friend.bdate) return \"\"\n    return parseVkDate(friend.bdate)\n  }\n\n  const getSex = (friend) => {\n    if (friend.sex === 1) return \"Женщина\"\n    else if (friend.sex === 2) return \"Мужчина\"\n    else return \"\"\n  }\n\n  const getDescription = (friend) => {\n    const age = getAge(friend)\n    return `${getSex(friend)}${age ? `, ${age}` : \"\"}`\n  }\n\n  const displayedFriends = useMemo(() => {\n    const processedFriends = closePeoples.map((friend) => ({\n      id: friend.id,\n      first_name: friend.first_name,\n      last_name: friend.last_name,\n      age: getAge(friend),\n      sex: getSex(friend),\n      photo_100: friend.photo_100,\n      description: getDescription(friend)\n    }))\n    if (!value) return processedFriends\n    else {\n      return processedFriends\n    }\n  }, [closePeoples, value])\n\n  const handleChange = (e) => {\n    setValue(e.target.value)\n  }\n\n  const onFiltersButtonClick = () => {\n    dispatch(showModal(Modals.FRIENDS_FILTERS))\n  }\n\n  return (\n    <Panel id={id}>\n      <PanelHeader\n        left={<PanelHeaderButton onClick={go} data-to=\"home\">\n          {osName === IOS ? <Icon28ChevronBack/> : <Icon24Back/>}\n        </PanelHeaderButton>}\n      >Пользователи</PanelHeader>\n      <FixedLayout vertical={\"top\"}>\n        <Search\n          value={value}\n          onChange={handleChange}\n          icon={<Icon24Filter/>}\n          onIconClick={onFiltersButtonClick}\n        />\n\n      </FixedLayout>\n      <Group style={{paddingTop: \"60px\"}}>\n        <List>\n          <InfiniteScroll\n            loadMore={debounceFetch.current}\n            hasMore={hasMore}\n            loader={<Cell><Spinner/></Cell>}\n          >\n            {displayedFriends && displayedFriends.map((friend) => (\n              <Cell\n                key={friend.id}\n                before={<Avatar src={friend.photo_100}/>}\n                description={friend.description}\n              >\n                {`${friend.first_name} ${friend.last_name}`}\n              </Cell>\n            ))}\n            </InfiniteScroll>\n        </List>\n      </Group>\n    </Panel>\n  )\n}\n\n\nexport const FiltersModal = ({id}) => {\n  const dispatch = useDispatch()\n  const filtersState = useSelector(state => state.friendsFilters)\n\n  const onModalClose = () => {\n    dispatch(closeModal())\n  }\n\n  const onReset = () => {\n    dispatch(resetFilters())\n  }\n\n  const onAgeChange = (e) => {\n    dispatch(changeFilters({age: parseInt(e.target.value)}))\n  }\n\n  const onSexChange = (e) => {\n    dispatch(changeFilters({sex: parseInt(e.target.value, 10)}))\n  }\n\n  return (\n    <ModalPage\n      id={id}\n      onClose={onModalClose}\n      header={\n        <ModalPageHeader\n          right={<PanelHeaderButton onClick={onModalClose}><Icon24Cancel/></PanelHeaderButton>}\n\n        >Фильтры</ModalPageHeader>\n      }>\n      <FormLayout>\n        <FormLayoutGroup top=\"Пол\" value={filtersState.sex} onChange={onSexChange}>\n          <Radio name=\"sex\" value={0} defaultChecked>Любой</Radio>\n          <Radio name=\"sex\" value={2}>Мужской</Radio>\n          <Radio name=\"sex\" value={1}>Женский</Radio>\n        </FormLayoutGroup>\n        <FormLayoutGroup top={\"Возраст\"}>\n          <Input type={\"number\"} name={\"age\"} value={filtersState.age} onChange={onAgeChange}/>\n        </FormLayoutGroup>\n        <Div style={{display: 'flex'}}>\n          <Button size=\"l\" stretched mode=\"secondary\" onClick={onReset} style={{ marginRight: 8 }}>Сбросить</Button>\n          <Button size=\"l\" stretched onClick={onModalClose}>Применить</Button>\n        </Div>\n      </FormLayout>\n    </ModalPage>\n\n  )\n}\n","import React, {useState, useEffect} from 'react';\nimport bridge from '@vkontakte/vk-bridge';\nimport View from '@vkontakte/vkui/dist/components/View/View';\nimport ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner';\nimport '@vkontakte/vkui/dist/vkui.css';\nimport Home from './panels/Home';\nimport Persik from './panels/Persik';\nimport {FiltersModal, Friends} from \"./panels/Friends\";\nimport {ModalRoot} from \"@vkontakte/vkui\";\nimport {useSelector} from \"react-redux\";\nimport {Modals} from \"./store/modalsSlice\";\n\nconst App = () => {\n  const [activePanel, setActivePanel] = useState('home');\n  const [user, setUser] = useState(null);\n  const [popout, setPopout] = useState(<ScreenSpinner size='large'/>);\n  const activeModal = useSelector(state => state.modals)\n\n  useEffect(() => {\n    bridge.subscribe(({detail: {type, data}}) => {\n      if (type === 'VKWebAppUpdateConfig') {\n        const schemeAttribute = document.createAttribute('scheme');\n        schemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n        document.body.attributes.setNamedItem(schemeAttribute);\n      }\n    });\n\n    async function fetchData() {\n      const user = await bridge.send('VKWebAppGetUserInfo');\n      setUser(user);\n      setPopout(null);\n    }\n    fetchData();\n  }, []);\n\n  const go = e => {\n    setActivePanel(e.currentTarget.dataset.to);\n  };\n\n  const modal = (\n    <ModalRoot activeModal={activeModal}>\n      <FiltersModal id={Modals.FRIENDS_FILTERS}/>\n    </ModalRoot>\n  )\n\n  return (\n    <View activePanel={activePanel} popout={popout} modal={modal}>\n      <Home id='home' fetchedUser={user} go={go} />\n      <Persik id='persik' go={go} />\n      <Friends id='friends' user={user} go={go}/>\n    </View>\n  );\n}\n\nexport default App;\n\n","import {combineReducers} from \"redux\";\nimport {friendsFiltersReducer} from \"./friendsFiltersSlice\";\nimport {modalsReducer} from \"./modalsSlice\";\n\nexport const rootReducer = combineReducers({\n  friendsFilters: friendsFiltersReducer,\n  modals: modalsReducer\n})\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\nimport {Provider} from \"react-redux\";\nimport {configureStore} from \"@reduxjs/toolkit\";\nimport {rootReducer} from \"./store\";\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nconst store = configureStore({\n  reducer: rootReducer\n})\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById(\"root\")\n);\nif (process.env.NODE_ENV === \"development\") {\n  import(\"./eruda\").then(({ default: eruda }) => {}); //runtime download\n}\n"],"sourceRoot":""}